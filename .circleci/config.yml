---
version: 2.1
jobs:
  build:
    machine: true
    steps:
      - checkout
      - run:
          name: "Installing AWS-CLI"
          command: |
            sudo apt update
            sudo apt install -y awscli
      - run:
          name: "ECR Auth"
          command: aws ecr get-login-password --region ${REGION} | docker login --username AWS --password-stdin ${ACCOUNT_ID}.dkr.ecr.${REGION}.amazonaws.com
      - run:
          name: building
          command: |
            docker build -t ${ACCOUNT_ID}.dkr.ecr.${REGION}.amazonaws.com/${REPO}:${CIRCLE_SHA1:0:10} .
            docker push ${ACCOUNT_ID}.dkr.ecr.${REGION}.amazonaws.com/${REPO}:${CIRCLE_SHA1:0:10}
workflows:
  nclouds-workflow:
    jobs:
      - build
